#.SUBDIRS: .

.PHONY: all install clean x

%.svg:%.mp
	echo "run mpost"
	mpost $<

duration=5
ips=20
mp_files=$(file $(shell python ../../../storylc/generate.py L-mp scene_1 $(ips) $(duration) ))
svg_files=$(file $(shell python ../../../storylc/generate.py L-svg scene_1 $(ips) $(duration) ))


$(mp_files): scene_1.mp
	python ../../../storylc/generate.py G scene_1 $(ips) $(duration)

scene_1.gif: $(svg_files)
	rm -f $@
	convert -delay $(div 1000 $(ips)) -loop 100 -size 1024x1024 $(svg_files) $@

%.mp4 : %.gif
	rm -f $@
	ffmpeg -i $< -movflags faststart -pix_fmt yuv420p -vf "scale=trunc(iw/2)*2:trunc(ih/2)*2" $@


all.mp4 :  scene_1.mp4
	echo $@
	rm -f $@
	ffmpeg -f concat -safe 0 -i infile.txt -c copy $@

all : all.mp4

x:
	echo $(mp_files)

clean:
	echo "clean"
	rm -f *.svg *.mp4 *.log *.gif *-*.mp
